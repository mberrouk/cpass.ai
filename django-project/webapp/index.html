{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Reputation System</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
  </head>
  <body>
    <div class="container">
      <!-- Dashboard Menu -->
      <div id="dashboard-screen">
        <div class="header">
          <h1 id="dashboard-title">
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Dashboard
          </h1>
          <p id="dashboard-subtitle">Welcome! Please sign up to get started</p>
          <div id="user-badge-container"></div>
        </div>

        <div class="menu-grid" id="menu-grid">
          <!-- Menu items will be dynamically inserted here -->
        </div>
      </div>

      <!-- Registration Form -->
      <div id="registration-screen" class="hidden">
        <div class="header">
          <h1>Create Profile</h1>
          <p id="role-label"></p>
        </div>

        <div class="card">
          <form id="registration-form">
            <div class="form-group">
              <label for="full-name">Full Name *</label>
              <input
                type="text"
                id="full-name"
                required
                placeholder="Enter your full name"
              />
            </div>

            <div class="form-group" id="skills-group">
              <label for="skills">Skills</label>
              <input
                type="text"
                id="skills"
                placeholder="e.g., delivery, packing, driving"
              />
            </div>

            <div class="form-group" id="bio-group">
              <label for="bio">Bio</label>
              <textarea
                id="bio"
                placeholder="Tell us about yourself..."
              ></textarea>
            </div>

            <div class="form-group" id="organization-group">
              <label for="organization">Organization</label>
              <input type="text" id="organization" placeholder="Company name" />
            </div>

            <button type="submit" class="button">Create Profile</button>
          </form>
        </div>
      </div>

      <!-- Main App Screen -->
      <div id="main-screen" class="hidden">
        <!-- Tasks View -->
        <div id="tasks-view">
          <div class="header">
            <h1>
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                ></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
              Tasks
            </h1>
            <p id="tasks-subtitle">Loading...</p>
          </div>
          <div id="tasks-list" class="task-list"></div>
        </div>

        <!-- Profile View -->
        <div id="profile-view" class="hidden">
          <div class="profile-header">
            <div class="avatar" id="profile-avatar">üë§</div>
            <h2 id="profile-name">Loading...</h2>
            <p id="profile-role"></p>
          </div>

          <div class="stats" id="profile-stats"></div>

          <div class="card" style="margin-top: 24px">
            <button class="button secondary" onclick="logout()">Logout</button>
          </div>
        </div>

        <!-- Create Task Form -->
        <!-- Create Task View - Multi-step -->
        <div id="create-task-view" class="hidden">
          <!-- Step 1: Select Category -->
          <div id="task-step-1" class="task-creation-step">
            <div class="header">
              <h1>üìÇ Select Category</h1>
              <p>Choose the type of work</p>
            </div>
            <div id="categories-list" class="card"></div>
            <div class="card" style="margin-top: 16px">
              <button
                class="button secondary"
                onclick="showScreen('dashboard-screen')"
              >
                Cancel
              </button>
            </div>
          </div>

          <!-- Step 2: Select Job -->
          <div id="task-step-2" class="task-creation-step hidden">
            <div class="header">
              <h1 id="step2-title">üîß Select Job</h1>
              <p id="step2-subtitle">Choose specific task</p>
            </div>
            <div id="jobs-list" class="card"></div>
            <div class="card" style="margin-top: 16px">
              <button class="button secondary" onclick="taskCreationGoBack(1)">
                Back
              </button>
            </div>
          </div>

          <!-- Step 3: Task Details -->
          <div id="task-step-3" class="task-creation-step hidden">
            <div class="header">
              <h1>üìù Task Details</h1>
              <p id="step3-subtitle">Complete the information</p>
            </div>
            <div class="card">
              <form id="create-task-form">
                <div class="form-group">
                  <label>Task Title *</label>
                  <input
                    type="text"
                    id="task-title"
                    required
                    placeholder="Enter task title"
                  />
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea
                    id="task-description"
                    rows="4"
                    placeholder="Enter task description"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label>Assign to Worker</label>
                  <select id="task-worker">
                    <option value="">Leave unassigned</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Deadline</label>
                  <input type="date" id="task-deadline" />
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px">
                  <button type="submit" class="button">Create Task</button>
                  <button
                    type="button"
                    class="button secondary"
                    onclick="taskCreationGoBack(2)"
                  >
                    Back
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Workers List View -->
        <div id="workers-view" class="hidden">
          <div class="header">
            <h1>
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              Workers
            </h1>
            <p>Manage your team</p>
          </div>
          <div id="workers-list" class="task-list"></div>
          <div class="card" style="margin-top: 16px">
            <button
              class="button secondary"
              onclick="showScreen('dashboard-screen')"
            >
              Back to Dashboard
            </button>
          </div>
        </div>

        <!-- My Tasks View (Worker) -->
        <div id="my-tasks-view" class="hidden">
          <div class="header">
            <h1>
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                ></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
              </svg>
              My Tasks
            </h1>
            <p>Tasks assigned to you</p>
          </div>
          <div id="my-tasks-list" class="task-list"></div>
          <div class="card" style="margin-top: 16px">
            <button
              class="button secondary"
              onclick="showScreen('dashboard-screen')"
            >
              Back to Dashboard
            </button>
          </div>
        </div>

        <!-- Task Detail View -->
        <div id="task-detail-view" class="hidden">
          <div class="header">
            <h1 id="task-detail-title">Task Details</h1>
          </div>
          <div class="card" id="task-detail-content"></div>
          <div class="card" style="margin-top: 16px">
            <button class="button secondary" onclick="goBackFromTask()">
              Back
            </button>
          </div>
        </div>

        <!-- Manage Tasks View (Supervisor) -->
        <div id="manage-tasks-view" class="hidden">
          <div class="header">
            <h1>
              <svg
                width="28"
                height="28"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path
                  d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                ></path>
              </svg>
              Manage Tasks
            </h1>
            <p>All your created tasks</p>
          </div>
          <div id="manage-tasks-list" class="task-list"></div>
          <div class="card" style="margin-top: 16px">
            <button
              class="button secondary"
              onclick="showScreen('dashboard-screen')"
            >
              Back to Dashboard
            </button>
          </div>
        </div>
      </div>

      <!-- Loading Screen -->
      <div id="loading-screen">
        <div class="loading">
          <div>‚è≥</div>
          <p>Loading...</p>
        </div>
      </div>
    </div>

    <!-- Bottom Menu -->
    <div class="menu hidden" id="bottom-menu">
      <div class="menu-item active" onclick="showView('tasks')">
        <svg
          class="icon"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
          ></path>
          <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
        </svg>
        <span>Tasks</span>
      </div>
      <div class="menu-item" onclick="showView('profile')">
        <svg
          class="icon"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span>Profile</span>
      </div>
    </div>

    <script>
      const CPASS_URL = "{{ cpass_url }}";
    </script>
    <script src="{% static 'api.js' %}"></script>
    <script src="{% static 'ui.js' %}"></script>
    <script src="{% static 'app.js' %}"></script>
  </body>
</html>
